# Skynet ç½‘ç»œå±‚æ–‡æ¡£ç´¢å¼•

æœ¬ç´¢å¼•æ•´ç†äº†Skynetç½‘ç»œå±‚çš„æ‰€æœ‰ç›¸å…³æ–‡æ¡£å’Œæ¶æ„å›¾ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥é˜…å’Œå­¦ä¹ ã€‚

## ğŸ“š æ ¸å¿ƒæ–‡æ¡£

### [ç½‘ç»œå±‚å®Œæ•´æ¶æ„æ–‡æ¡£](./skynet-network-layer-architecture.md)
è¯¦ç»†ä»‹ç»Skynetç½‘ç»œå±‚çš„è®¾è®¡ä¸å®ç°ï¼ŒåŒ…æ‹¬ï¼š
- æ•´ä½“æ¶æ„è®¾è®¡
- æ ¸å¿ƒæ•°æ®ç»“æ„
- å·¥ä½œæœºåˆ¶è¯¦è§£
- æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- å®é™…åº”ç”¨ç¤ºä¾‹

## ğŸ¨ æ¶æ„å›¾è¡¨

æ‰€æœ‰æ¶æ„å›¾è¡¨ä½äº `docs/diagrams/network/` ç›®å½•ï¼Œä½¿ç”¨Mermaidæ ¼å¼ç»˜åˆ¶ã€‚

### æ¶æ„è®¾è®¡å›¾

#### 1. [ç½‘ç»œå±‚æ•´ä½“æ¶æ„å›¾](./diagrams/network/network-architecture.mmd)
å±•ç¤ºäº”å±‚æ¶æ„è®¾è®¡ï¼Œä»åº”ç”¨å±‚åˆ°ç³»ç»Ÿå†…æ ¸å±‚çš„å®Œæ•´ç»“æ„ã€‚

#### 2. [SocketçŠ¶æ€æœºå›¾](./diagrams/network/socket-state-machine.mmd)
æè¿°Socketåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­çš„æ‰€æœ‰çŠ¶æ€è½¬æ¢ã€‚

#### 3. [socket_serveræ ¸å¿ƒæ•°æ®ç»“æ„](./diagrams/network/socket-server-structure.mmd)
è¯¦ç»†å±•ç¤ºsocket_serverå†…éƒ¨çš„æ•°æ®ç»„ç»‡æ–¹å¼ã€‚

### æ•°æ®æµç¨‹å›¾

#### 4. [æ•°æ®æ¥æ”¶æµç¨‹å›¾](./diagrams/network/data-receive-flow.mmd)
ä»ç½‘ç»œæ•°æ®åˆ°è¾¾åˆ°æœåŠ¡å¤„ç†çš„å®Œæ•´æ¥æ”¶è·¯å¾„ã€‚

#### 5. [æ•°æ®å‘é€æµç¨‹å›¾](./diagrams/network/data-send-flow.mmd)
ä»æœåŠ¡å‘é€æ•°æ®åˆ°ç½‘ç»œä¼ è¾“çš„å®Œæ•´å‘é€è·¯å¾„ã€‚

### æœºåˆ¶åŸç†å›¾

#### 6. [ç½‘ç»œçº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹äº¤äº’](./diagrams/network/thread-interaction.mmd)
å±•ç¤ºç½‘ç»œçº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹ä¹‹é—´çš„åä½œæœºåˆ¶ã€‚

#### 7. [Socket IDç®¡ç†æœºåˆ¶](./diagrams/network/socket-id-management.mmd)
è§£é‡ŠSocket IDçš„åˆ†é…ã€æ˜ å°„å’Œå¤ç”¨æœºåˆ¶ã€‚

#### 8. [å†™ç¼“å†²åŒºç®¡ç†](./diagrams/network/write-buffer-management.mmd)
è¯´æ˜åŒä¼˜å…ˆçº§é˜Ÿåˆ—å’Œç¼“å†²åŒºé“¾è¡¨çš„è®¾è®¡ã€‚

## ğŸ—‚ æºç æ–‡ä»¶å¯¹ç…§

ç½‘ç»œå±‚æ ¸å¿ƒæºç æ–‡ä»¶ä½äº `skynet-src/` ç›®å½•ï¼š

| æ–‡ä»¶å | åŠŸèƒ½è¯´æ˜ | ä»£ç è¡Œæ•° |
|--------|---------|----------|
| `socket_server.c` | SocketæœåŠ¡å™¨æ ¸å¿ƒå®ç° | 2400+ |
| `skynet_socket.c` | ä¸Šå±‚æ¥å£å°è£… | 300+ |
| `socket_poll.h` | IOå¤šè·¯å¤ç”¨ç»Ÿä¸€æ¥å£ | 33 |
| `socket_epoll.h` | Linux epollå®ç° | 82 |
| `socket_kqueue.h` | BSD kqueueå®ç° | 120+ |

## ğŸ” å¿«é€Ÿå¯¼èˆª

### åˆå­¦è€…è·¯çº¿
1. å…ˆé˜…è¯»[ç½‘ç»œå±‚æ•´ä½“æ¶æ„å›¾](./diagrams/network/network-architecture.mmd)äº†è§£æ€»ä½“ç»“æ„
2. å­¦ä¹ [SocketçŠ¶æ€æœºå›¾](./diagrams/network/socket-state-machine.mmd)ç†è§£è¿æ¥ç®¡ç†
3. é€šè¿‡[æ•°æ®æ¥æ”¶æµç¨‹å›¾](./diagrams/network/data-receive-flow.mmd)å’Œ[æ•°æ®å‘é€æµç¨‹å›¾](./diagrams/network/data-send-flow.mmd)ç†è§£æ•°æ®ä¼ è¾“
4. æœ€åé˜…è¯»[å®Œæ•´æ¶æ„æ–‡æ¡£](./skynet-network-layer-architecture.md)æ·±å…¥ç»†èŠ‚

### è¿›é˜¶å¼€å‘è·¯çº¿
1. ç ”ç©¶[socket_serveræ ¸å¿ƒæ•°æ®ç»“æ„](./diagrams/network/socket-server-structure.mmd)
2. ç†è§£[Socket IDç®¡ç†æœºåˆ¶](./diagrams/network/socket-id-management.mmd)
3. åˆ†æ[å†™ç¼“å†²åŒºç®¡ç†](./diagrams/network/write-buffer-management.mmd)
4. æŒæ¡[çº¿ç¨‹äº¤äº’æœºåˆ¶](./diagrams/network/thread-interaction.mmd)

### æ€§èƒ½ä¼˜åŒ–è·¯çº¿
1. å…³æ³¨å†™ç¼“å†²åŒºç®¡ç†çš„åŒä¼˜å…ˆçº§é˜Ÿåˆ—è®¾è®¡
2. äº†è§£æ‰¹é‡äº‹ä»¶å¤„ç†æœºåˆ¶(MAX_EVENT=64)
3. ç ”ç©¶é›¶æ‹·è´å’Œç›´å†™æ¨¡å¼ä¼˜åŒ–
4. å­¦ä¹ åŸå­æ“ä½œå’Œæ— é”åŒ–è®¾è®¡

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

æ ¹æ®æ–‡æ¡£åˆ†æï¼ŒSkynetç½‘ç»œå±‚çš„å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼š

- **å¹¶å‘è¿æ¥æ•°**ï¼šå•æœºå¯æ”¯æŒæ•°ä¸‡å¹¶å‘è¿æ¥
- **Socketæ§½ä½**ï¼š65536ä¸ª(2^16)
- **äº‹ä»¶æ‰¹å¤„ç†**ï¼šæ¯æ¬¡æœ€å¤šå¤„ç†64ä¸ªäº‹ä»¶
- **ç¼“å†²åŒºä¼˜å…ˆçº§**ï¼šåŒé˜Ÿåˆ—è®¾è®¡ï¼Œä¿è¯æ§åˆ¶æ¶ˆæ¯ä¼˜å…ˆ
- **çº¿ç¨‹æ¨¡å‹**ï¼šå•ç½‘ç»œçº¿ç¨‹ï¼Œé¿å…é”ç«äº‰

## ğŸ›  è°ƒè¯•ä¸ç›‘æ§

- ä½¿ç”¨`skynet.stat`è·å–ç½‘ç»œç»Ÿè®¡ä¿¡æ¯
- é€šè¿‡socket_statç»“æ„ç›‘æ§è¯»å†™å­—èŠ‚æ•°
- è­¦å‘Šé˜ˆå€¼æœºåˆ¶(WARNING_SIZE)ç›‘æ§ç¼“å†²åŒºçŠ¶æ€
- è°ƒè¯•æ§åˆ¶å°æŸ¥çœ‹è¿æ¥çŠ¶æ€

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [Skynetå®Œæ•´æ¶æ„åˆ†æ](./skynet-complete-architecture-analysis.md)
- [Skynetæ¨¡å—ç¤ºä¾‹](./skynet_module_examples.md)
- [Requireæ¨¡å—æŸ¥æ‰¾æŒ‡å—](./require_module_lookup_guide.md)

## æ›´æ–°è®°å½•

- 2024-09-27: åˆ›å»ºç½‘ç»œå±‚å®Œæ•´æ–‡æ¡£å’Œæ¶æ„å›¾
- æ–‡æ¡£ç‰ˆæœ¬: 1.0

---

*æœ¬ç´¢å¼•åŸºäºSkynetæºç åˆ†æç”Ÿæˆï¼ŒæŒç»­æ›´æ–°ä¸­ã€‚*